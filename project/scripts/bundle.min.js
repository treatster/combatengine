"use strict";!function(){var e=/\d+m?s$/;function s(t,r,i){"string"==typeof t&&("number"!=typeof r&&(r=!1),$(document).trigger({type:":notify",message:t,delay:r,class:i||""}))}$(document.body).append("<div id='notify'></div>"),$(document).on(":notify",function(t){t.message&&"string"==typeof t.message&&(t.message.trim(),t.class?"string"==typeof t.class?t.class="open macro-notify "+t.class:Array.isArray(t.class)?t.class="open macro-notify "+t.class.join(" "):t.class="open macro-notify":t.class="open macro-notify",t.delay?("number"!=typeof t.delay&&(t.delay=Number(t.delay)),Number.isNaN(t.delay)&&(t.delay=2e3)):t.delay=2e3,$("#notify").empty().wiki(t.message).addClass(t.class),setTimeout(function(){$("#notify").removeClass()},t.delay))}),Macro.add("notify",{tags:null,handler:function(){var t,r=this.payload[0].contents,i=!1,n=!1;0<this.args.length&&(t=e.test(this.args[0]),n="number"==typeof this.args[0]||t?(i=t?Util.fromCssTime(this.args[0]):this.args[0],1<this.args.length&&this.args.slice(1).flatten()):this.args.flatten().join(" ")),s(r,i,n)}}),setup.notify=s}(),function(){function i(t,n){var e=0,s=t.length;t.forEach(function(t){var r,i;r=t,i=function(){++e===s&&n()},(t=new Image).onload=i,t.onerror=i,t.src=r})}function n(){return State.length<=0}function t(){var t=[].slice.call(arguments).flatten(),r=!!n()&&LoadScreen.lock();return i(t,function(){r&&LoadScreen.unlock(r)}),r}setup.preload=t,setup.preload.force=!1,Macro.add("preload",{handler:function(){if(!n()&&!setup.preload.force)return this.error("Attempting to preload images outside of `StoryInit` or similar can cause performance issues. Set `setup.preload.force` to `true` if you want to do it anyway.");t(this.args.flatten().filter(function(t){return"string"==typeof t}))}})}(),function(){var r=["a",":button",'*[role="button"]',".continue-macro-ignore","#ui-bar","#ui-dialog"],e=0;function i(){$(document).on("click.continue-macro keyup.continue-macro",r.join(", "),function(t){t.stopPropagation()})}function t(){if(0<State.length)return!1;var t=[].slice.call(arguments).flatten();return r=r.concat(t),!0}function s(t,r){var i,n=(i="."+Date.now().toString(36)+"-"+e,e++,i);r&&"function"==typeof r&&(i="click.continue-macro"+n,t&&(i=i+" keyup.continue-macro"+n),$(document).one(i,function(){r.call(),$(document).off(n)}))}prehistory["%%continue-expiration"]=function(){e=0},$(document).one(":passagerender",function(){i()}),Macro.add("ignore",{handler:function(){if(!t(this.args))return this.error("the <<ignore>> macro should only be run from StoryInit or equivalent.")}}),Macro.add("cont",{tags:null,handler:function(){var t,r=this.args.includes("append"),i=this.args.includesAny("key","keypress","press","button"),n=this.payload[0].contents;r&&(t=$(document.createElement("span")).addClass("macro-"+this.name).appendTo(this.output)),s(i,this.createShadowWrapper(function(){(r&&t&&t instanceof $?t:$).wiki(n)}))}}),setup.cont=s,setup.cont.ignore=t,setup.cont.reset=function(){var t=[].slice.call(arguments).flatten();r=r.concat(t),$(document).off(".continue-macro"),i()},window.cont=window.cont||setup.cont}(),function(){var n={update:UIBar.setStoryElements,stow:UIBar.stow,unstow:UIBar.unstow,toggle:function(){$("#ui-bar").hasClass("stowed")?UIBar.unstow():UIBar.stow()},hide:function(){$("#ui-bar").css("display","none")},show:function(){$("#ui-bar").css("display","block")},kill:function(){$("#ui-bar").css("display","none"),$("#story").css("margin-left","2.5em")},restore:function(){$("#ui-bar").css("display","block"),$("#story").css("margin-left","20em")},jump:UI.jumpto,saves:UI.saves,restart:UI.restart,settings:UI.settings,share:UI.share,aliases:{refresh:"update",reload:"update",destroy:"kill",revive:"restore",jumpto:"jump",save:"saves",load:"saves",setting:"settings",sharing:"share"}},e=Object.keys(n);Macro.add("ui",{handler:function(){Array.isArray(this.args)&&this.args.length||this.error("No commands passed to macro.");var t=function(t){if(!Array.isArray(t))return"Command list error.";var i=[];return t.forEach(function(t){var r;i.push((r=t)&&"string"==typeof r?(t=r=r.toLowerCase().trim(),e.includes(t)||(r=n.aliases[r]||null)?(n[r](),!1):'Command "'+r+'" is not a valid command.'):"Command is not a string.")}),i}(this.args.flatten()),r=(t=t.filter(function(t){return"string"==typeof t})).join(" ");t.length&&r&&this.error(r)}})}(),function(){var f={tryGlobal:!0,defaultStrings:{empty:"The inventory is empty...",listDrop:"Discard",separator:"\n"}};function s(t,r,i,n){$(document).trigger({type:"initialized"===n?":inventory-init":":inventory-update",instance:t,receiving:r,moved:i,context:n})}function a(t){if(t=t?(t=[].slice.call(arguments)).flatten():[],!(this instanceof a))return new a(t);this.inv=t,s(this,null,t=t.length?t:null,"initialized")}Object.assign(a,{is:function(t){return t instanceof a},log:function(t){return a.is(t)?"Inventory.log() -> "+t.toArray().join(" - "):"Inventory.log() -> object is not an inventory..."},removeDuplicates:function(t){if(a.is(t)){var t=t.toArray(),r=[];return t.forEach(function(t){r.includes(t)||r.push(t)}),r}}}),Object.assign(a.prototype,{transfer:function(t){if(arguments.length<2)return this;if(!a.is(t))return this;for(var r=[].slice.call(arguments),i=[],n=0,e=(r=r.slice(1).flatten()).length;n<e;n++)this.inv.includes(r[n])&&(this.inv.delete(r[n]),i.push(r[n]));return i.length&&(t.inv=t.inv.concat(i),s(this,t,i,"transfer")),this},has:function(){var t=[].slice.call(arguments).flatten();return!(!t||!t.length)&&this.inv.includesAny(t)},hasAll:function(){var t=[].slice.call(arguments).flatten();return!(!t||!t.length)&&this.inv.includesAll(t)},pickUp:function(t){var r,i=[].slice.call(arguments).flatten(),n=this;return i&&i.length&&("unique"!==t&&"unique"!==i[0]||(t=i=i.splice(1),r=[],t.forEach(function(t){n.inv.includes(t)||r.includes(t)||r.push(t)}),i=r),this.inv=this.inv.concat(i),s(this,null,i,"pickup")),this},drop:function(){var r,i,t=[].slice.call(arguments).flatten(),n=this;return t&&t.length&&(i=[],t.forEach(function(t){n.has(t)&&(i.push(t),r=n.inv.indexOf(t),n.inv.deleteAt(r))}),s(this,null,i,"drop")),this},sort:function(){return this.inv=this.inv.sort(),s(this,null,null,"sort"),this},show:function(t){return t&&"string"==typeof t||(t=f.defaultStrings.separator),this.inv.length?this.inv.join(t):f.defaultStrings.empty},empty:function(){var t=clone(this.inv);return this.inv=[],s(this,null,t,"drop"),this},toArray:function(){return this.inv},count:function(r){if(r&&"string"==typeof r){var i=0;return this.toArray().forEach(function(t){t===r&&i++}),i}return this.toArray().length},isEmpty:function(){return 0===this.toArray().length},linkedList:function(o,l){o&&a.is(o)||(o=!1);var t=this.toArray(),u=this,c=$(document.createElement("span"));return t&&t.length?t.forEach(function(t,r,i){var n=$(document.createElement("span")),e=$(document.createElement("a")),s=l||f.defaultStrings.drop,a=function(t,r){var i=Math.random().toString(36).substring(7);return arguments.length<2&&(t=Math.random().toString(36).substring(7),r=random(99)),"simple-inv-"+r+"-"+Date.now()+"-"+t.replace(/[^A-Za-z0-9]/g,"")+"-"+i}(t,r);e.wiki(s).addClass("simple-inv drop-link"),e.ariaClick(function(){o?u.transfer(o,t):u.drop(t),$("#"+a).empty()}),n.attr("id",a).addClass("simple-inv link-listing").wiki(t+" ").append(e),r<i.length-1&&n.wiki("<br />"),c.append(n)}):c.wiki(f.defaultStrings.empty),c},constructor:a,toJSON:function(){return JSON.reviveWrapper("new setup.Inventory("+JSON.stringify(this.inv)+")")},clone:function(){return new a(this.inv)}}),setup.Inventory=a,setup.simpleInv={inventory:a},f.tryGlobal&&(window.Inventory=window.Inventory||a),Macro.add("newinventory",{handler:function(){if(this.args.length<1)return this.error("incorrect number of arguments");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Wikifier.setValue(t,new a(this.args.slice(1).flatten()))}}),Macro.add("pickup",{handler:function(){if(this.args.length<2)return this.error("incorrect number of arguments");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(t);if(!a.is(r))return this.error("variable "+t+" is not an inventory!");r.pickUp(this.args.slice(1).flatten())}}),Macro.add("drop",{handler:function(){if(this.args.length<2)return this.error("incorrect number of arguments");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(t);if(!a.is(r))return this.error("variable "+t+" is not an inventory!");r.drop(this.args.slice(1).flatten())}}),Macro.add("transfer",{handler:function(){if(this.args.length<3)return this.error("incorrect number of arguments");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(t);if(!a.is(r))return this.error("variable "+t+" is not an inventory!");var i=this.args[1].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');t=Wikifier.getValue(i);if(!a.is(t))return this.error("variable "+i+" is not an inventory!");r.transfer(t,this.args.slice(2).flatten())}}),Macro.add("dropall",{handler:function(){if(1!==this.args.length)return this.error("incorrect number of arguments");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(t);if(!a.is(r))return this.error("variable "+t+" is not an inventory!");r.empty()}}),Macro.add("clear","dropall",!1),Macro.add("sort",{handler:function(){if(1!==this.args.length)return this.error("incorrect number of arguments");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(t);if(!a.is(r))return this.error("variable "+t+" is not an inventory!");r.sort()}}),Macro.add("inventory",{handler:function(){if(this.args.length<1||2<this.args.length)return this.error("incorrect number of arguments");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(t);if(!a.is(r))return this.error("variable "+t+" is not an inventory!");var i=$(document.createElement("span")),t=!!this.args[1]&&this.args[1];i.wiki(r.show(t)).addClass("macro-"+this.name).appendTo(this.output)}}),Macro.add("linkedinventory",{handler:function(){if(this.args.length<2||3<this.args.length)return this.error("incorrect number of arguments");var t=!1,r="",i=this.args[1].trim(),n="string"==typeof this.args[0]&&this.args[0];if(!n)return this.error("first argument should be the link text");if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');var e=Util.slugify(i),e=this.name+"-"+e,s=Wikifier.getValue(i);if(!a.is(s))return this.error("variable "+i+" is not an inventory!");if(2<this.args.length){if("$"!==(r=this.args[2].trim())[0]&&"_"!==r[0])return this.error('variable name "'+this.args[2]+'" is missing its sigil ($ or _)');if(t=Wikifier.getValue(r),!a.is(t))return this.error("variable "+r+" is not an inventory!")}s.linkedList(t,n).attr({id:e,"data-rec":r,"data-self":i,"data-action":n}).addClass("macro-"+this.name).appendTo(this.output)}})}(),window.Flag=function(t){if(null==State.variables.Flags)State.variables.Flags={};else if(void 0!==State.variables.Flags[t.toLowerCase()])return State.variables.Flags[t.toLowerCase()];return!1},Config.saves.onSave=function(t,r){"slot"===r.type&&(t.title=prompt("Enter Save Slot Title:",t.title))},Config.saves.onLoad=function(t){console.log("Loaded game title: "+t.title),console.log("Loaded game version: "+t.version)};